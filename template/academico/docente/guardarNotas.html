{% extends 'base.html' %}

{% block jquerycript %} 
	$(":input").change
	(
		function() 
		{
			var validar = $(":input").validator({lang: 'es'});
			if (!validar.data("validator").checkValidity())
			{
				this.focus();
			}
			else
			{
				numero = $(this).val();		
		    	numero = numero.toString().replace(",", ".");
		    	
		    	if ($(this).attr("nota") != null)	{numero = parseFloat(numero); numero = numero.toFixed(1);}
			   	else								{numero = parseInt(numero);}
		        
		        if (isNaN(numero))	
		    	{
		    		$(this).val("");
		    	}
		    	else
		    	{	
			    	url = ($(this).attr("nota") != null)?"nota/":"falla/";
			    	idCalificacion = $(this).attr("idCalificacion");
			        idCorte = $(this).attr("idCorte");
			        
			    	$.post
			        (	
			        	url,
			        	{
			        		idCalificacion: idCalificacion,
			        		idCorte: idCorte,
			        		valor: numero
			        	}, 	        	
			        	function(data) 
			        	{
			        		$("#" + idCalificacion + "_notaHab").html(data[0]["fields"]["nota_habilitacion"]);
			        		$("#" + idCalificacion + "_notaDef").html(data[0]["fields"]["nota_definitiva"]);
			        		$("#" + idCalificacion + "_totalFallas").html(data[0]["fields"]["fallas"]);    		
			        	},
			        	"json" 	
			        );
			        $(this).val(numero.toString());
				}
			}
		}
	);
	
	$.tools.validator.localize
	(
		"es", {'[required]' 	: 'Digite un valor adecuado'}
	);	
{% endblock %}

{% block ruta %} 
	<ul id="nav">
		<li><a href="/">Inicio</a></li>
		<li>>></li>
		<li>Competencias</li>
	</ul>
{% endblock %}

{% block contenido %}
	<div id="content" class="with_sidebar">
		<h1> {{curso.nombre}} </h1>		
		<table id="estudiantes" class="grilla" width="100%">
			<thead>
				<tr>
					<th>CÃ³digo</th>
					<th>Nombre</th>					
					{% for corte in cortes %} 
						<th>{{corte.porcentaje}}%</th>
						<th>F.</th>
					{% endfor %}	
					<th style="width: 20px;">F.T.</th>
					<th style="width: 20px;">Hab.</th>
					<th style="width: 20px;">Def.</th>					
				</tr>
			</thead>
			<tbody>				
				{% for calificacion in calificaciones %}
					<tr class="{% cycle '' 'odd' %}">
						<th scope="row"><a href="#">{{ calificacion.codigo_estudiante }}</a></th>
						<td>{{ calificacion.nombre_estudiante }}</td>
						{% for corte in cortes %} 
							<td style="text-align:center">
								{% if corte.corte_actual %}
									<input type="text" name="nota_{{calificacion.id}}_{{corte.id}}" id="nota_{{calificacion.id}}_{{corte.id}}" 
									{% for llave, valor in calificacion.items %}
									    {% ifequal llave corte.id %}
									    	value="{{ valor.nota }}"
									    {% endifequal %}
									{% endfor %}
									nota="nota" idCalificacion="{{calificacion.id}}" idCorte="{{corte.id}}" required="required"/>
								{% else %}
									{% for llave, valor in calificacion.items %}
									    {% ifequal llave corte.id %}
									    	{{ valor.nota }}
									    {% endifequal %}
									{% endfor %}
								{% endif %}
							</td>
							<td style="text-align:center">
								{% if corte.corte_actual %}
									<input type="text" name="falla_{{calificacion.id}}_{{corte.id}}" id="falla_{{calificacion.id}}_{{corte.id}}"
									{% for llave, valor in calificacion.items %}
									    {% ifequal llave corte.id %}
									    	value="{{ valor.fallas }}"
									    {% endifequal %}
									{% endfor %}
									fala="falla" idCalificacion="{{calificacion.id}}" idCorte="{{corte.id}}" required="required"/>
								{% else %}
									{% for llave, valor in calificacion.items %}
									    {% ifequal llave corte.id %}
									    	{{ valor.fallas }}
									    {% endifequal %}
									{% endfor %}
								{% endif %}
							</td>
						{% endfor %}
						<td style="text-align:center"><div id="{{calificacion.id}}_totalFallas">{{ calificacion.fallas }}</div></td>
						<td style="text-align:center"><div id="{{calificacion.id}}_notaHab">{{ calificacion.nota_habilitacion }}</div></td>
						<th style="text-align:center"><div id="{{calificacion.id}}_notaDef">{{ calificacion.nota_definitiva }}</div></th>
					</tr>					
				{% endfor %}
			</tbody>
			<tfoot>
				<tr>
					<th scope="row" colspan="{{ cantidadCortes }}">Total Estudiantes: {{ cantidad }}</td>
				</tr>
			</tfoot>
		</table>
	</div>			
{% endblock %}